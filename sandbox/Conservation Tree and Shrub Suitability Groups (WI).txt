PARAMETER areasym PROMPT "Enter Survey Area Symbol" CHAR.
PARAMETER mukeys PROMPT "Or List of Mapunit Keys" MULTIPLE CHAR.
PARAMETER includeminor PROMPT "Include minor soils?" BOOLEAN.
PARAMETER useNationalMapunits PROMPT "Display national mapunit symbols?" BOOLEAN.

BASE TABLE component.

EXEC SQL SELECT 
compname, 
localphase, 
muname, 
mapunit.mukey, 
mapunit.mukey AS mukey_link, 
areaname, 
musym, 
chorizon.chkey, 
comppct_r, 
nationalmusym, 
component.cokey, component.cokey AS cokey_main, 
compkind AS compkind2	, 
constreeshrubgrp, 
taxorder AS order2 , 
taxsuborder AS suborder, 
hzdept_r, 
hzdepb_r, 
hzdepb_r AS botdep, 

sieveno10_r, sieveno200_r, 
ph1to1h2o_r, ec_r, caco3_r, sar_r, awc_r, claytotal_r, sandtotal_r, texture, taxpartsize, ph01mcacl2_r
FROM legend
INNER JOIN mapunit ON mapunit.lkey=legend.lkey AND(areasymbol=$areasym  OR mapunit.mukey in (mukeys) ) 
INNER JOIN component ON component.mukey=mapunit.mukey  AND  ( majcompflag = "Yes" OR 1 = includeminor )
INNER JOIN chorizon ON chorizon.cokey=component.cokey
LEFT OUTER JOIN chtexturegrp ON chtexturegrp.chkey=chorizon.chkey
WHERE chtexturegrp.rvindicator='Yes'
ORDER BY case when $useNationalMapunits =0 then areaname else nationalmusym end,  
muname ASC, comppct_r DESC, component.cokey, hzdept_r ASC, hzdepb_r ASC, chorizon.chkey;
AGGREGATE ROWS by component.cokey
COLUMN hzdept_r NONE, hzdepb_r NONE, botdep LAST, sieveno10_r NONE, sieveno200_r NONE, awc_r NONE, ph1to1h2o_r NONE, 
ec_r NONE, caco3_r NONE, sar_r NONE, claytotal_r NONE, sandtotal_r NONE, texture NONE, ph01mcacl2_r NONE.

EXEC SQL SELECT TOP 1 resdept_r, cor1.corestrictkey
FROM component AS c1
INNER JOIN  corestrictions AS cor1 ON cor1.cokey=c1.cokey  AND c1.cokey IN ($cokey_main)
AND reskind IN (
'Lithic bedrock', 
'Paralithic bedrock',
'Densic bedrock',
'Abrupt textural change', 
'Densic material', 
'Duripan', 
'Fragipan', 
'Natric', 
'Ortstein', 
'Permafrost', 
'Petrocalcic',
'Petroferric',
'Petrogypsic',
'Placic',
'Plinthite',
'Salic',
'Strongly contrasting textural stratification',
'Sulfuric')
ORDER BY  resdept_r ASC, cor1.corestrictkey;.

# Gets the minimum water table depth during the growing season
EXEC SQL SELECT soimoiststat, com1.month, soimoistdept_r, taxtempregime AS tempregime
FROM component AS c2
INNER JOIN comonth AS com1 ON com1.cokey=c2.cokey AND c2.cokey IN ($cokey_main)
INNER JOIN cosoilmoist  AS cos1 ON cos1.comonthkey=com1.comonthkey
AND soimoiststat = 'Wet' 
and ((taxtempregime in ("gelic", "pergelic") AND com1.month in ('July', 'August'))
or (taxtempregime in ("cryic") AND com1.month in ('June', 'July', 'August'))
or (taxtempregime in ("frigid", "isofrigid") AND com1.month in ('May', 'June', 'July', 'August', 'September'))
or (taxtempregime in ("mesic") AND com1.month in ('March', 'April', 'May', 'June', 'July', 'August', 'September', 'October'))
or (taxtempregime in ("thermic") AND com1.month in ('February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October'))
or (taxtempregime in ("hyperthermic") AND com1.month in ('February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December')) 
or (taxtempregime in ("isothermic", "isohyperthermic", "isomesic") 
	and com1.month in ('January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'))
or taxtempregime IS NULL);
AGGREGATE COLUMN soimoistdept_r MIN.

# Gets the flooding status during the growing season
EXEC SQL select flodfreqcl, floddurcl AS floddurcl2, taxtempregime tempregm
FROM component AS c3
INNER JOIN comonth AS com2 ON com2.cokey=c3.cokey AND c3.cokey IN ($cokey_main)
and flodfreqcl in ('Very frequent', 'Frequent') 
and ((taxtempregime in ("gelic", "pergelic") AND com2.month in ('July', 'August'))
or (taxtempregime in ("cryic") AND com2.month in ('June', 'July', 'August'))
or (taxtempregime in ("frigid", "isofrigid") AND com2.month in ('May', 'June', 'July', 'August', 'September'))
or (taxtempregime in ("mesic") AND com2.month in ('March', 'April', 'May', 'June', 'July', 'August', 'September', 'October'))
or (taxtempregime in ("thermic") AND com2.month in ('February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October'))
or (taxtempregime in ("hyperthermic") AND com2.month in ('February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December')) 
or (taxtempregime in ("isothermic", "isohyperthermic", "isomesic") 
	and com2.month in ('January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'))
or taxtempregime IS NULL);
AGGREGATE COLUMN floddurcl2 NONE.

EXEC SQL SELECT geomfname, geomfeatid, existsonfeat
    FROM component AS c4
INNER JOIN 	cogeomordesc ON cogeomordesc.cokey=c4.cokey AND c4.cokey IN ($cokey_main)
 AND geomftname = 'Landform'; 
AGGREGATE COLUMN geomfname NONE, geomfeatid NONE, existsonfeat NONE.

DEFINE landform	SECASE (ARRAYCAT (GEOMORDESC(geomfname, geomfeatid, existsonfeat), ", ")).


EXEC SQL SELECT  laoverlap.areasymbol AS  mlra2, laoverlap.areaname
FROM laoverlap  
INNER JOIN legend AS l ON l.lkey=laoverlap.lkey AND laoverlap.areatypename ='MLRA'
INNER JOIN muaoverlap ON muaoverlap.lareaovkey=laoverlap.lareaovkey
INNER JOIN mapunit ON mapunit.mukey=muaoverlap.mukey AND mapunit.mukey IN ($mukey_link);
AGGREGATE COLUMN mlra2 LIST ', '.


#EXEC SQL SELECT ecoclasstypename, ecoclassref,  ecoclassid, ecoclassname, coecoclasskey, sourcesdwprimarykey, sourcesdwtablephysicalname 
#FROM  component  AS ce
#INNER JOIN coecoclass ON coecoclass.cokey=ce.cokey AND ecoclasstypename = 'Forest Habitat Type' AND ce.cokey IN ($cokey_main);.

DEFINE reporttitle   INITIAL SCRIPT(REPORT_TITLE).
DEFINE reporthdrtext IF NEW(areaname) THEN reporthdrtext ELSE "" 
                     INITIAL SCRIPT(REPORT_HEADER).
DEFINE interptitle   INITIAL SCRIPT(INTERP_TITLE).

# Toggle a shading type for alternating components
DEFINE toggle        IF NEW (mapunit.mukey) THEN 0
                     ELSE IF NEW(component.cokey) THEN 1-toggle ELSE toggle.
DEFINE shading	IF toggle == 1 THEN "odd" ELSE "even". 


DEFINE space		INITIAL "".
DEFINE areabreak	IF useNationalMapunits THEN "Map Units" ELSE areaname.
DEFINE mu_lead		(IF useNationalMapunits THEN nationalmusym ELSE musym )
					|| "--" || muname.
DEFINE soilnm		SECASE (ISNULL(localphase) ? compname : compname||", "||localphase).



#DEFINE compkind2	CODENAME(compkind).
#DEFINE floddurcl2	CODENAME(floddurcl).
#DEFINE order		CODENAME(taxorder).
#DEFINE suborder		CODENAME(taxsuborder).
#DEFINE tempregime	CODENAME(taxtempregime).

DEFINE histosols	IF order2 == "Histosols" OR suborder == "Histels" OR any (texture imatches "*PEAT*" OR texture imatches "*MUCK*" or
					texture imatches "*MPT*") THEN "yes" ELSE "no".

# Gets the total depth of thin O horizons.
DEFINE O_hrzn		IF texture imatches "*HPM*" OR texture imatches "*MPM*" OR texture imatches "*SPM*" 
					OR texture imatches "*UDOM*" OR texture imatches "*PDOM*" THEN hzdepb_r ELSE 0.
DEFINE O_hrzn_depth	ARRAYMAX(O_hrzn).

# Gets the soil depth to the first restriction (minus any O horizon depths)
DEFINE soil_depth	IF not isnull(resdept_r) THEN resdept_r - O_hrzn_depth
					ELSE botdep - O_hrzn_depth.

# Gets total available water capacity of the soil to the first restriction (excludes O horizons)
DEFINE hrzn_awc		IF texture imatches "*HPM*" OR texture imatches "*MPM*" OR texture imatches "*SPM*" 
					OR texture imatches "*UDOM*" OR texture imatches "*PDOM*" OR (hzdept_r >= resdept_r
					and not isnull(resdept_r)) THEN 0 ELSE ROUND(awc_r*(hzdepb_r - hzdept_r),1).
DEFINE total_awc	ROUND(ARRAYSUM(hrzn_awc),1).

# Gets the weighted average CaCO3 equivalent in the upper 30 cm of soil (excludes O horizons)
DEFINE CaCO3_eq		IF texture imatches "*HPM*" OR texture imatches "*MPM*" OR texture imatches "*SPM*" 
					OR texture imatches "*UDOM*" OR texture imatches "*PDOM*" OR hzdept_r >= O_hrzn_depth + 30 THEN 1/0 
					ELSE IF ISNULL (caco3_r) THEN 0 ELSE caco3_r.
DEFINE hzthickness	IF hzdept_r +0  >= O_hrzn_depth  + 0 AND hzdepb_r +0 <= O_hrzn_depth + 30 THEN hzdepb_r - hzdept_r
					ELSE IF hzdept_r +0  < O_hrzn_depth + 30 AND hzdepb_r +0 > O_hrzn_depth + 30 THEN O_hrzn_depth + 30 - hzdept_r
					ELSE null.
DEFINE CaCO3_equiv	WTAVG(CaCO3_eq, hzthickness).

# Gets the maximum SAR in the upper 30 cm of soil (excludes O horizons)
DEFINE hrzn_sar		IF texture imatches "*HPM*" OR texture imatches "*MPM*" OR texture imatches "*SPM*" 
					OR texture imatches "*UDOM*" OR texture imatches "*PDOM*" OR hzdept_r >= O_hrzn_depth + 30 THEN 0 
					ELSE IF ISNULL (sar_r) THEN 0 ELSE sar_r.
DEFINE sodium		ARRAYMAX(hrzn_sar).

# Gets the minimum pH within the upper 30 cm of soil (excludes O horizons)
DEFINE hrzn_ph		IF texture imatches "*HPM*" OR texture imatches "*MPM*" OR texture imatches "*SPM*" 
					OR texture imatches "*UDOM*" OR texture imatches "*PDOM*" OR hzdept_r >= O_hrzn_depth + 30 THEN 1/0 
					ELSE IF ISNULL (ph1to1h2o_r) THEN ph01mcacl2_r ELSE ph1to1h2o_r.
DEFINE phh2o		ROUND(ARRAYMIN(hrzn_ph),1).

# Gets the maximum EC in the upper 30 cm of soil (excludes O horizons)
DEFINE hrzn_ec		IF texture imatches "*HPM*" OR texture imatches "*MPM*" OR texture imatches "*SPM*" 
					OR texture imatches "*UDOM*" OR texture imatches "*PDOM*" OR hzdept_r >= O_hrzn_depth + 30 THEN 0 
					ELSE IF ISNULL (ec_r) tHEN 0 ELSE ec_r.
DEFINE ecc			ARRAYMAX(hrzn_ec).

# Gets the depths AND total depth between 20 AND 120 cm.
DEFINE depth20_120	IF hzdept_r + 0 < 20 + 0 AND hzdepb_r + 0 > 20 + 0 AND not isnull(claytotal_r) THEN hzdepb_r - 20
					ELSE IF hzdept_r +0 >= 20 + 0 AND hzdepb_r + 0 <= 120 + 0 AND not isnull(claytotal_r) THEN hzdepb_r - hzdept_r
					ELSE IF hzdept_r +0 >= 20 + 0  AND hzdept_r +0 < 120 + 0  + 0 AND hzdepb_r + 0 > 120 + 0  AND not isnull(claytotal_r) THEN 120 - hzdept_r
					ELSE 1/0.
DEFINE sum_depth20_120		ARRAYSUM(depth20_120).

# Gets the weighted average of clay between 20 AND 120 cm.
DEFINE wt_ave_clay20_120	ARRAYSUM(claytotal_r*depth20_120/sum_depth20_120).

# Gets the weighted average of sand between 20 AND 120 cm.
DEFINE wt_ave_sand20_120	ARRAYSUM(sandtotal_r*depth20_120/sum_depth20_120).

# Gets the weighted average of sand/gravel between 20 AND 120 cm.
DEFINE wt_ave_sandgrav20_120 ARRAYSUM((sieveno10_r*sieveno200_r/100)*depth20_120/sum_depth20_120).

# Determines if the 20 to 120 cm depth is sandy, sandy/gravelly, loamy, OR clayey.
DEFINE sandy			IF wt_ave_sand20_120 + 0 >= wt_ave_clay20_120 + 70 THEN "yes" ELSE "no".
DEFINE sandy_gravelly	IF wt_ave_sandgrav20_120 + 0 <= 15 + 0 THEN "yes" ELSE "no".
DEFINE loamy			IF wt_ave_clay20_120 + 0  < 35 + 0 AND wt_ave_sand20_120 + 0 < wt_ave_clay20_120 + 70 AND 
							wt_ave_sandgrav20_120 + 0 > 15 + 0 THEN "yes" ELSE "no".
DEFINE clayey			IF wt_ave_clay20_120 + 0 >= 35 + 0 THEN "yes" ELSE "no".

# Gets the depth to the first clayey layer (total clay > 35%).
DEFINE overclayey		IF claytotal_r + 0 > 35 + 0 THEN hzdept_r ELSE 1/0.
DEFINE depth_to_clayey	ARRAYMIN(overclayey).

# Gets the depth to the first sandy OR sandy/gravelly layer.
DEFINE nonsandy_surface	IF sandtotal_r + 0 >= wt_ave_clay20_120 + 70 OR sieveno10_r*sieveno200_r/100 <= 15 + 0 THEN hzdept_r ELSE 1/0.
DEFINE depth_to_sandy	ARRAYMIN(nonsandy_surface).

# Gets the depth to the first sandy/gravelly layer.
DEFINE nonsandgravel_surface	IF sieveno10_r*sieveno200_r/100 <= 15 + 0 THEN hzdept_r ELSE 1/0.
DEFINE depth_to_sandgravel		ARRAYMIN(nonsandgravel_surface).


#ASSIGN total_awc SPRINTF ("%.2f",total_awc).
#ASSIGN phh2o  SPRINTF ("%.2f",phh2o).
#ASSIGN CaCO3_equiv SPRINTF ("%.1f",CaCO3_equiv).

ASSIGN soimoistdept_r IF ISNULL (soimoistdept_r) THEN 200 ELSE soimoistdept_r.

# Group 1 ---------------
DEFINE ctsg	IF soil_depth + 0 >= 100 + 0  AND total_awc + 0 >= 22.5 + 0  AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 5.1 + 0  AND phh2o + 0 <= 7.8 + 0  AND ecc + 0 <= 2 + 0  AND soimoistdept_r + 0  >= 45 + 0  AND soimoistdept_r + 0 < 120 + 0 
			and histosols == "no" THEN "1"

			ELSE IF soil_depth + 0 >= 100 + 0  AND total_awc + 0 >= 22.5 + 0  AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 4.0 + 0 AND phh2o + 0 <= 5.0 + 0  AND ecc + 0 <= 2 + 0  AND soimoistdept_r + 0  >= 45 + 0  AND soimoistdept_r + 0 < 120 + 0 
			and histosols == "no" THEN "1a"

			ELSE IF soil_depth + 0 >= 100 + 0  AND total_awc + 0 >= 22.5 + 0 
			and phh2o + 0 <= 7.8 + 0  AND ecc + 0 <= 4 + 0  + 0 AND soimoistdept_r + 0  >= 45 + 0  AND soimoistdept_r + 0 < 120 + 0 
			and histosols == "yes" THEN "1h"

			ELSE IF soil_depth + 0 >= 100 + 0  AND total_awc + 0 >= 22.5 + 0  AND CaCO3_equiv + 0  > 5 + 0 AND CaCO3_equiv + 0 <= 15 + 0 AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 7.9 + 0 AND phh2o + 0 <= 8.4 + 0 AND ecc + 0 <= 4 + 0  AND soimoistdept_r + 0  >= 45 + 0  AND soimoistdept_r + 0 < 120 + 0 
			and histosols == "no" THEN "1k"

			ELSE IF soil_depth + 0 >= 100 + 0  AND total_awc + 0 >= 15.2 + 0 AND total_awc + 0 <= 22.4 + 0  AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 5.1 + 0  AND phh2o + 0 <= 7.8 + 0  AND ecc + 0 <= 2 + 0  AND soimoistdept_r + 0  >= 45 + 0  AND soimoistdept_r + 0 < 120 + 0 
			and histosols == "no" THEN "1s"

			ELSE IF soil_depth + 0 >= 100 + 0  AND total_awc + 0 >= 15.2 + 0 AND total_awc + 0 <= 22.4 + 0  AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 4.0 + 0 AND phh2o + 0 <= 5.0 + 0  AND ecc + 0 <= 2 + 0  AND soimoistdept_r + 0  >= 45 + 0  AND soimoistdept_r + 0 < 120 + 0 
			and histosols == "no" THEN "1sa"

			ELSE IF soil_depth + 0 >= 100 + 0  AND total_awc + 0 >= 15.2 + 0 AND total_awc + 0 <= 22.4 + 0  AND CaCO3_equiv + 0  > 5 + 0 AND CaCO3_equiv + 0 <= 15 + 0 AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 7.9 + 0 AND phh2o + 0 <= 8.4 + 0 AND ecc + 0 <= 4 + 0  AND soimoistdept_r + 0  >= 45 + 0  AND soimoistdept_r + 0 < 120 + 0 
			and histosols == "no" THEN "1sk"

			ELSE IF soil_depth + 0 >= 100 + 0  AND total_awc + 0 >= 7.6 + 0  AND total_awc + 0 <= 15.2  + 0 AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 5.1 + 0  AND phh2o + 0 <= 7.8 + 0  AND ecc + 0 <= 2 + 0  AND soimoistdept_r + 0  >= 45 + 0  AND soimoistdept_r + 0 < 120 + 0 
			and histosols == "no" THEN "1ss"

			ELSE IF soil_depth + 0 >= 100 + 0  AND total_awc + 0 >= 7.6 + 0  AND total_awc + 0 <= 15.2  + 0 AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 4.0 + 0 AND phh2o + 0 <= 5.0 + 0  AND ecc + 0 <= 2 + 0  AND soimoistdept_r + 0  >= 45 + 0  AND soimoistdept_r + 0 < 120 + 0 
			and histosols == "no" THEN "1ssa"

# Group 2 -------------------
			ELSE IF soil_depth + 0 >= 100 + 0  AND total_awc + 0 >= 7.6 + 0  AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 5.1 + 0  AND phh2o + 0 <= 7.8 + 0  AND ecc + 0 <= 2 + 0  AND soimoistdept_r + 0  >= 15 AND soimoistdept_r + 0 < 45
			and histosols == "no" THEN "2"

			ELSE IF soil_depth + 0 >= 100 + 0  AND total_awc + 0 >= 7.6 + 0  AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 4.0 + 0 AND phh2o + 0 <= 5.0 + 0  AND ecc + 0 <= 2 + 0  AND soimoistdept_r + 0  >= 15 AND soimoistdept_r + 0 < 45
			and histosols == "no" THEN "2a"	

			ELSE IF soil_depth + 0 >= 100 + 0  AND total_awc + 0 >= 7.6 + 0  AND CaCO3_equiv + 0  > 5 + 0 AND CaCO3_equiv + 0 <= 15 + 0 AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 7.9 + 0 AND phh2o + 0 <= 8.4 + 0 AND ecc + 0 <= 4 + 0  AND soimoistdept_r + 0  >= 15 AND soimoistdept_r + 0 < 45
			and histosols == "no" THEN "2k"	

			ELSE IF soil_depth + 0 >= 100 + 0  AND total_awc + 0 >= 22.5 + 0 
			and phh2o + 0 <= 7.8 + 0  AND ecc + 0 <= 4 + 0  AND soimoistdept_r + 0  >= 15 AND soimoistdept_r + 0 < 45
			and histosols == "yes" THEN "2h"
			
# Group 3 -------------------
			ELSE IF soil_depth + 0 >= 100 + 0  AND total_awc + 0 >= 22.5 + 0  AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 5.1 + 0  AND phh2o + 0 <= 7.8 + 0  AND ecc + 0 <= 2 + 0  AND (soimoistdept_r + 0  >= 120 + 0  OR ISNULL (soimoistdept_r))
			and loamy == "yes" AND histosols == "no" THEN "3"

			ELSE IF soil_depth + 0 >= 100 + 0  AND total_awc + 0 >= 22.5 + 0  AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 4.0 + 0 AND phh2o + 0 <= 5.0 + 0  AND ecc + 0 <= 2 + 0  AND (soimoistdept_r + 0  >= 120 + 0  OR ISNULL (soimoistdept_r))
			and loamy == "yes" AND histosols == "no" THEN "3a"	

# Group 8 -------------------
			ELSE IF soil_depth + 0 >= 100 + 0  AND total_awc + 0 >= 22.5 + 0  AND CaCO3_equiv + 0  > 5 + 0 AND CaCO3_equiv + 0 <= 15 + 0 AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 7.9 + 0 AND phh2o + 0 <= 8.4 + 0 AND ecc + 0 <= 4 + 0  AND (soimoistdept_r + 0  >= 120 + 0  OR ISNULL (soimoistdept_r))
			and loamy == "yes"
			and histosols == "no" THEN "8"

# Group 4 -------------------	
			ELSE IF soil_depth + 0 >= 50 + 0  AND total_awc + 0 >= 17.0 + 0 AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 5.1 + 0  AND phh2o + 0 <= 7.8 + 0  AND ecc + 0 <= 2 + 0  AND (soimoistdept_r + 0  >= 120 + 0  OR ISNULL (soimoistdept_r))
			and depth_to_clayey > 20 AND depth_to_clayey <= 50 + 0 AND not isnull(depth_to_clayey) 
			and histosols == "no" THEN "4"

			ELSE IF soil_depth + 0 >= 50 + 0  AND total_awc + 0 >= 17.0 + 0 AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 4.0 + 0 AND phh2o + 0 <= 5.0 + 0  AND ecc + 0 <= 2 + 0  AND (soimoistdept_r + 0  >= 120 + 0  OR ISNULL (soimoistdept_r))
			and depth_to_clayey > 20 AND depth_to_clayey <= 50 + 0 AND not isnull(depth_to_clayey)
			and histosols == "no" THEN "4a"

			ELSE IF soil_depth + 0 >= 50 + 0  AND total_awc + 0 >= 10.0 AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 4.0 + 0 AND phh2o + 0 <= 5.0 + 0  AND ecc + 0 <= 2 + 0  AND (soimoistdept_r + 0  >= 120 + 0  OR ISNULL (soimoistdept_r))
			and depth_to_clayey > 20 AND depth_to_clayey <= 50 + 0 AND not isnull(depth_to_clayey)
			and histosols == "no" THEN "4sa"

			ELSE IF soil_depth + 0 >= 50 + 0  AND total_awc + 0 >= 17.0 + 0 AND CaCO3_equiv + 0  > 5 + 0 AND CaCO3_equiv + 0 <= 15 + 0 AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 7.9 + 0 AND phh2o + 0 <= 8.4 + 0 AND ecc + 0 <= 4 + 0  AND (soimoistdept_r + 0  >= 120 + 0  OR ISNULL (soimoistdept_r))
			and depth_to_clayey > 20 AND depth_to_clayey <= 50 + 0 AND not isnull(depth_to_clayey)
			and histosols == "no" THEN "4k"

			ELSE IF soil_depth + 0 >= 50 + 0  AND total_awc + 0 >= 15.2 + 0 AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 5.1 + 0  AND phh2o + 0 <= 7.8 + 0  AND ecc + 0 <= 2 + 0  AND (soimoistdept_r + 0  >= 120 + 0  OR ISNULL (soimoistdept_r))
			and clayey == "yes" AND histosols == "no" THEN "4c"

			ELSE IF soil_depth + 0 >= 50 + 0  AND total_awc + 0 >= 15.2 + 0 AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 4.0 + 0 AND phh2o + 0 <= 5.0 + 0  AND ecc + 0 <= 2 + 0  AND (soimoistdept_r + 0  >= 120 + 0  OR ISNULL (soimoistdept_r))
			and clayey == "yes" AND histosols == "no" THEN "4ca"

			ELSE IF soil_depth + 0 >= 50 + 0  AND total_awc + 0 >= 15.2 + 0 AND CaCO3_equiv + 0  > 5 + 0 AND CaCO3_equiv + 0 <= 15 + 0 AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 7.9 + 0 AND phh2o + 0 <= 8.4 + 0 AND ecc + 0 <= 4 + 0  AND (soimoistdept_r + 0  >= 120 + 0  OR ISNULL (soimoistdept_r))
			and clayey == "yes" AND histosols == "no" THEN "4ck"

# Group 5 -------------------
			ELSE IF soil_depth + 0 >= 100 + 0  AND total_awc + 0 >= 15.2 + 0 AND total_awc + 0 <= 22.4 + 0  AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 5.1 + 0  AND phh2o + 0 <= 7.8 + 0  AND ecc + 0 <= 2 + 0  AND (soimoistdept_r + 0  >= 120 + 0  OR ISNULL (soimoistdept_r))
			and sandy == "no" AND (depth_to_sandy != 0 OR O_hrzn_depth != depth_to_sandy) AND histosols == "no" THEN "5"

			ELSE IF soil_depth + 0 >= 100 + 0  AND total_awc + 0 >= 15.2 + 0 AND total_awc + 0 <= 22.4 + 0  AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 4.0 + 0 AND phh2o + 0 <= 5.0 + 0  AND ecc + 0 <= 2 + 0  AND (soimoistdept_r + 0  >= 120 + 0  OR ISNULL (soimoistdept_r))
			and sandy == "no" AND (depth_to_sandy != 0 OR O_hrzn_depth != depth_to_sandy) AND histosols == "no" THEN "5a"

			ELSE IF soil_depth + 0 >= 100 + 0  AND total_awc + 0 >= 15.2 + 0 AND total_awc + 0 <= 22.4 + 0  AND CaCO3_equiv + 0  > 5 + 0 AND CaCO3_equiv + 0 <= 15 + 0 AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 7.9 + 0 AND phh2o + 0 <= 8.4 + 0 AND ecc + 0 <= 4 + 0  AND (soimoistdept_r + 0  >= 120 + 0  OR ISNULL (soimoistdept_r))
			and sandy == "no" AND (depth_to_sandy != 0 OR O_hrzn_depth != depth_to_sandy) AND histosols == "no" THEN "5k"

# Group 6 -------------------
			ELSE IF soil_depth + 0 >= 50 + 0  AND total_awc + 0 >= 7.6 + 0  AND total_awc + 0 <= 15.1  + 0 AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 5.1 + 0  AND phh2o + 0 <= 7.8 + 0  AND ecc + 0 <= 2 + 0  AND (soimoistdept_r + 0  >= 120 + 0  OR ISNULL (soimoistdept_r))
			and (depth_to_sandy + 0 > 20 + 0 OR ISNULL (depth_to_sandy)) 
			and histosols == "no" THEN "6"

			ELSE IF soil_depth + 0 >= 50 + 0  AND total_awc + 0 >= 7.6 + 0  AND total_awc + 0 <= 15.1  + 0 AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 4.0 + 0 AND phh2o + 0 <= 5.0 + 0  AND ecc + 0 <= 2 + 0  AND (soimoistdept_r + 0  >= 120 + 0  OR ISNULL (soimoistdept_r))
			and (depth_to_sandy + 0 > 20 + 0 OR ISNULL (depth_to_sandy))
			and histosols == "no" THEN "6a"

			ELSE IF soil_depth + 0 >= 50 + 0  AND total_awc + 0 >= 7.6 + 0  AND total_awc + 0 <= 15.1  + 0 AND CaCO3_equiv + 0  > 5 + 0 AND CaCO3_equiv + 0 <= 15 + 0 AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 7.9 + 0 AND phh2o + 0 <= 8.4 + 0 AND ecc + 0 <= 4 + 0  AND (soimoistdept_r + 0  >= 120 + 0  OR ISNULL (soimoistdept_r))
			and (depth_to_sandy + 0 > 20 + 0 OR ISNULL (depth_to_sandy))
			and histosols == "no" THEN "6k"

			ELSE IF soil_depth + 0 >= 50 + 0  AND soil_depth + 0 <=100 + 0 AND total_awc + 0 >= 15.2 + 0 AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 5.1 + 0  AND phh2o + 0 <= 7.8 + 0  AND ecc + 0 <= 2 + 0  AND (soimoistdept_r + 0  >= 120 + 0  OR ISNULL (soimoistdept_r))
			and (depth_to_sandy + 0 > 20 + 0 OR ISNULL (depth_to_sandy))
			and histosols == "no" THEN "6d"

			ELSE IF soil_depth + 0 >= 50 + 0  AND soil_depth + 0 <=100 + 0 AND total_awc + 0 >= 15.2 + 0 AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 4.0 + 0 AND phh2o + 0 <= 5.0 + 0  AND ecc + 0 <= 2 + 0  AND (soimoistdept_r + 0  >= 120 + 0  OR ISNULL (soimoistdept_r))
			and (depth_to_sandy + 0 > 20 + 0 OR ISNULL (depth_to_sandy))
			and histosols == "no" THEN "6da"

			ELSE IF soil_depth + 0 >= 50 + 0  AND soil_depth + 0 <=100 + 0 AND total_awc + 0 >= 15.2 + 0 AND CaCO3_equiv + 0  > 5 + 0 AND CaCO3_equiv + 0 <= 15 + 0 AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 7.9 + 0 AND phh2o + 0 <= 8.4 + 0 AND ecc + 0 <= 4 + 0  AND (soimoistdept_r + 0  >= 120 + 0  OR ISNULL (soimoistdept_r))
			and (depth_to_sandy + 0 > 20 + 0 OR ISNULL (depth_to_sandy))
			and histosols == "no" THEN "6dk"

# Group 7 -------------------
			ELSE IF soil_depth + 0 >= 50 + 0  AND total_awc + 0 >= 7.6 + 0  AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 5.1 + 0  AND phh2o + 0 <= 7.8 + 0  AND ecc + 0 <= 2 + 0  AND (soimoistdept_r + 0  >= 120 + 0  OR ISNULL (soimoistdept_r))
			and (depth_to_sandy == 0 OR O_hrzn_depth == depth_to_sandy) AND not isnull(depth_to_sandy)
			and sandy == "yes" 
			and histosols == "no" THEN "7s"

			ELSE IF soil_depth + 0 >= 50 + 0  AND total_awc + 0 >= 7.6 + 0  AND CaCO3_equiv + 0  > 5 + 0 AND CaCO3_equiv + 0 <= 15 + 0 AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 7.9 + 0 AND phh2o + 0 <= 8.4 + 0 AND ecc + 0 <= 4 + 0  AND (soimoistdept_r + 0  >= 120 + 0  OR ISNULL (soimoistdept_r))
			and (depth_to_sandy == 0 OR O_hrzn_depth == depth_to_sandy) AND not isnull(depth_to_sandy)
			and sandy == "yes" 
			and histosols == "no" THEN "7sk"

			ELSE IF soil_depth + 0 >= 50 + 0  AND total_awc + 0 >= 7.6 + 0  AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 4.0 + 0 AND phh2o + 0 <= 5.0 + 0  AND ecc + 0 <= 2 + 0  AND (soimoistdept_r + 0  >= 120 + 0  OR ISNULL (soimoistdept_r))
			and (depth_to_sandy == 0 OR O_hrzn_depth == depth_to_sandy) AND not isnull(depth_to_sandy)
			and sandy == "yes" 
			and histosols == "no" THEN "7sa"

			ELSE IF soil_depth + 0 >= 50 + 0  AND total_awc + 0 >= 7.6 + 0  AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 5.1 + 0  AND phh2o + 0 <= 7.8 + 0  AND ecc + 0 <= 2 + 0  AND (soimoistdept_r + 0  >= 120 + 0  OR ISNULL (soimoistdept_r))
			and (depth_to_sandy == 0 OR O_hrzn_depth == depth_to_sandy) AND not isnull(depth_to_sandy)
			and histosols == "no" THEN "7"

			ELSE IF soil_depth + 0 >= 50 + 0  AND total_awc + 0 >= 7.6 + 0  AND CaCO3_equiv + 0  > 5 + 0 AND CaCO3_equiv + 0 <= 15 + 0 AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 7.9 + 0 AND phh2o + 0 <= 8.4 + 0 AND ecc + 0 <= 4 + 0  AND (soimoistdept_r + 0  >= 120 + 0  OR ISNULL (soimoistdept_r))
			and (depth_to_sandy == 0 OR O_hrzn_depth == depth_to_sandy) AND not isnull(depth_to_sandy)
			and histosols == "no" THEN "7k"

			ELSE IF soil_depth + 0 >= 50 + 0  AND total_awc + 0 >= 7.6 + 0  AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 4.0 + 0 AND phh2o + 0 <= 5.0 + 0  AND ecc + 0 <= 2 + 0  AND (soimoistdept_r + 0  >= 120 + 0  OR ISNULL (soimoistdept_r))
			and (depth_to_sandy == 0 OR O_hrzn_depth == depth_to_sandy) AND not isnull(depth_to_sandy)
			and histosols == "no" THEN "7a"

# Group 9 -------------------
			ELSE IF soil_depth + 0 >= 50 + 0  AND total_awc + 0 >= 7.6 + 0  AND ((sodium + 0 < 25 + 0 AND ecc + 0  > 4 AND ecc + 0 <= 16 + 0 ) OR 
			(sodium >= 13 + 0 AND sodium + 0 < 25 + 0 AND ecc + 0 <= 16 + 0 )) AND (soimoistdept_r + 0  >= 45 + 0  OR ISNULL (soimoistdept_r))
			AND histosols == "no" THEN "9"

			ELSE IF soil_depth + 0 >= 50 + 0  AND total_awc + 0 >= 7.6 + 0  AND ((sodium + 0 < 25 + 0 AND ecc + 0  > 4 AND ecc + 0 <= 16 + 0 ) OR 
			(sodium >= 13 + 0 AND sodium + 0 < 25 + 0 AND ecc + 0 <= 16 + 0 )) AND soimoistdept_r + 0 < 45 + 0 
			and histosols == "no" THEN "9w"

# Group 10 -------------------
			ELSE IF  (soil_depth + 0 < 50 + 0 AND not isnull(soil_depth)) OR (total_awc < 7.6 + 0 AND not isnull(total_awc)) OR 
			CaCO3_equiv > 15 + 0 OR sodium >= 25 + 0 OR (phh2o < 4.0 AND not isnull(phh2o)) OR phh2o > 8.4 + 0  OR ecc > 16 + 0 OR 
			(soimoistdept_r + 0 < 15 + 0 AND not isnull(soimoistdept_r))
			THEN "10"

			ELSE null.
			


# Rates sandy substratum soils that have a AWC > 15.1 AND puts them in group 5. This is after getting a null ctsg rating in the above define statement).
# AWC was the important criterion for doing this. 
ASSIGN ctsg		IF soil_depth + 0 >= 100 + 0  AND total_awc + 0 >= 15.2 + 0 AND total_awc + 0 <= 22.4 + 0  AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
				and phh2o + 0 >= 5.1 + 0  AND phh2o + 0 <= 7.8 + 0  AND ecc + 0 <= 2 + 0  AND (soimoistdept_r + 0  >= 120 + 0  OR ISNULL (soimoistdept_r))
				and sandy == "yes" AND (depth_to_sandy != 0 OR O_hrzn_depth != depth_to_sandy) AND histosols == "no"
				and isnull(ctsg) THEN "5"

				ELSE IF soil_depth + 0 >= 100 + 0  AND total_awc + 0 >= 15.2 + 0 AND total_awc + 0 <= 22.4 + 0  AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
				and phh2o + 0 >= 4.0 + 0 AND phh2o + 0 <= 5.0 + 0  AND ecc + 0 <= 2 + 0  AND (soimoistdept_r + 0  >= 120 + 0  OR ISNULL (soimoistdept_r))
				and sandy == "yes" AND (depth_to_sandy != 0 OR O_hrzn_depth != depth_to_sandy) AND histosols == "no" 
				and isnull(ctsg) THEN "5a"

				ELSE IF soil_depth + 0 >= 100 + 0  AND total_awc + 0 >= 15.2 + 0 AND total_awc + 0 <= 22.4 + 0  AND CaCO3_equiv + 0  > 5 + 0 AND CaCO3_equiv + 0 <= 15 + 0 AND sodium + 0 < 13 + 0 
				and phh2o + 0 >= 7.9 + 0 AND phh2o + 0 <= 8.4 + 0 AND ecc + 0 <= 4 + 0  AND (soimoistdept_r + 0  >= 120 + 0  OR ISNULL (soimoistdept_r))
				and sandy == "yes" AND (depth_to_sandy != 0 OR O_hrzn_depth != depth_to_sandy) AND histosols == "no" 
				and isnull(ctsg) THEN "5k"

				ELSE ctsg.


# When a soil falls into a gap in the CTSG criteria, an onsite investigation is needed by a local forestor to place 
# the soil into an appropriate group. When a soil falls into a gap the calculation assigns the nearest match to a CTSG OR 
# if a shallower soil a 10 is assigned.

# GROUP 1---------------------
ASSIGN ctsg	IF isnull(ctsg) AND soil_depth + 0 >= 50 + 0  AND soil_depth + 0 < 100 + 0 AND total_awc + 0 >= 22.5 + 0  AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 5.1 + 0  AND phh2o + 0 <= 7.8 + 0  AND ecc + 0 <= 2 + 0  AND soimoistdept_r + 0  >= 45 + 0  AND soimoistdept_r + 0 < 120 + 0  AND histosols == "no"
			THEN "11"
			#DISPLAY "The soil falls into a gap in the criteria. The nearest match is group 10 with soil depth %s being too shallow for group 1." soil_depth.

			ELSE IF ISNULL (ctsg) AND soil_depth + 0 >= 100 + 0  AND total_awc + 0 >= 22.5 + 0  AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			AND phh2o + 0  > 7.9 + 0 AND phh2o + 0 <= 8.4 + 0 AND ecc + 0 <= 2 + 0  AND soimoistdept_r + 0  >= 45 + 0  AND soimoistdept_r + 0 < 120 + 0  AND histosols == "no"
			THEN "1k" # pH indicates the chemical acitivities within a soil 
			#DISPLAY "The soil falls into a gap in the criteria. The nearest match is group 1k with CaCO3 %s being outside the range." CaCO3_equiv.

			ELSE IF ISNULL (ctsg) AND soil_depth + 0 >= 100 + 0  AND total_awc + 0 >= 22.5 + 0  AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 5.1 + 0  AND phh2o + 0 <= 7.8 + 0  AND ecc + 0  > 2 + 0 AND ecc + 0 <= 4 + 0  AND soimoistdept_r + 0  >= 45 + 0  AND soimoistdept_r + 0 < 120 + 0  AND histosols == "no"
			THEN "1"
			#DISPLAY "The soil falls into a gap in the criteria. The nearest match is group 1 with EC %s being outside the range." ecc.

			ELSE IF ISNULL (ctsg) AND soil_depth + 0 >= 100 + 0  AND total_awc + 0 >= 22.5 + 0  AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 4.0 + 0 AND phh2o + 0 <= 5.0 + 0  AND ecc + 0  > 2 + 0 AND ecc + 0 <= 4 + 0  AND soimoistdept_r + 0  >= 45 + 0  AND soimoistdept_r + 0 < 120 + 0  AND histosols == "no"
			THEN "1a"
			#DISPLAY "The soil falls into a gap in the criteria. The nearest match is group 1a with EC %s being outside the range." ecc.

			ELSE IF ISNULL (ctsg) AND soil_depth + 0 >= 100 + 0  AND total_awc + 0 >= 22.5 + 0  AND phh2o > 7.9 + 0 AND phh2o + 0 <= 8.4 + 0 AND ecc + 0 <= 4 + 0 
			and soimoistdept_r + 0  >= 45 + 0  AND soimoistdept_r + 0 < 120 + 0  AND histosols == "yes"
			THEN "1h"
			#DISPLAY "The soil falls into a gap in the criteria. The nearest match is group 1h with pH %s being outside the range." phh2o.

			ELSE IF ISNULL (ctsg) AND soil_depth + 0 >= 50 + 0  AND soil_depth + 0 < 100 + 0 AND total_awc + 0 >= 15.2 + 0 AND total_awc + 0 <= 22.4 + 0  AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 5.1 + 0  AND phh2o + 0 <= 7.8 + 0  AND ecc + 0 <= 2 + 0  AND soimoistdept_r + 0  >= 45 + 0  AND soimoistdept_r + 0 < 120 + 0  AND histosols == "no"
			THEN "11"
			#DISPLAY "The soil falls into a gap in the criteria. The nearest match is group 10 with soil depth %s being too shallow for group 1s." soil_depth.

			ELSE IF ISNULL (ctsg) AND soil_depth + 0 >= 100 + 0  AND total_awc + 0 >= 15.2 + 0 AND total_awc + 0 <= 22.4 + 0  AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			AND phh2o + 0  > 7.9 + 0 AND phh2o + 0 <= 8.4 + 0 AND ecc + 0 <= 2 + 0  AND soimoistdept_r + 0  >= 45 + 0  AND soimoistdept_r + 0 < 120 + 0  AND histosols == "no"
			THEN "1sk"
			#DISPLAY "The soil falls into a gap in the criteria. The nearest match is group 1sk with CaCO3 %s being outside the range." CaCO3_equiv

			ELSE IF ISNULL (ctsg) AND soil_depth + 0 >= 100 + 0  AND total_awc + 0 >= 15.2 + 0 AND total_awc + 0 <= 22.4 + 0  AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 5.1 + 0  AND phh2o + 0 <= 7.8 + 0  AND ecc + 0  > 2 + 0 AND ecc + 0 <= 4 + 0  AND soimoistdept_r + 0  >= 45 + 0  AND soimoistdept_r + 0 < 120 + 0  AND histosols == "no"
			THEN "1s" 
			#DISPLAY "The soil falls into a gap in the criteria. The nearest match is group 1s with EC %s being outside the range." ecc.

			ELSE IF ISNULL (ctsg) AND soil_depth + 0 >= 50 + 0  AND soil_depth + 0 < 100 + 0 AND total_awc + 0 >= 15.2 + 0 AND total_awc + 0 <= 22.4 + 0  AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 4.0 + 0 AND phh2o + 0 <= 5.0 + 0  AND ecc + 0 <= 2 + 0  AND soimoistdept_r + 0  >= 45 + 0  AND soimoistdept_r + 0 < 120 + 0  AND histosols == "no"
			THEN "11" 
			#DISPLAY "The soil falls into a gap in the criteria. The nearest match is group 10 with soil depth %s being too shallow for group 1sa." soil_depth.

			ELSE IF ISNULL (ctsg) AND soil_depth + 0 >= 100 + 0  AND total_awc + 0 >= 15.2 + 0 AND total_awc + 0 <= 22.4 + 0  AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 4.0 + 0 AND phh2o + 0 <= 5.0 + 0  AND ecc + 0  > 2 + 0 AND ecc + 0 <= 4 + 0  AND soimoistdept_r + 0  >= 45 + 0  AND soimoistdept_r + 0 < 120 + 0  AND histosols == "no"
			THEN "1sa"
			#DISPLAY "The soil falls into a gap in the criteria. The nearest match is group 1sa with EC %s being outside the range." ecc.

			ELSE IF ISNULL (ctsg) AND soil_depth + 0 >= 50 + 0  AND soil_depth + 0 < 100 + 0 AND total_awc + 0 >= 15.2 + 0 AND total_awc + 0 <= 22.4 + 0  AND CaCO3_equiv + 0  > 5 + 0 AND CaCO3_equiv + 0 <= 15 + 0 AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 7.9 + 0 AND phh2o + 0 <= 8.4 + 0 AND ecc + 0 <= 4 + 0  AND soimoistdept_r + 0  >= 45 + 0  AND soimoistdept_r + 0 < 120 + 0  AND histosols == "no"
			THEN "11" 
			#DISPLAY "The soil falls into a gap in the criteria. The nearest match is group 10 with soil depth %s being too shallow for group 1sk." soil_depth.

			ELSE IF ISNULL (ctsg) AND soil_depth + 0 >= 50 + 0  AND soil_depth + 0 < 100 + 0 AND total_awc + 0 >= 7.6 + 0  AND total_awc + 0 <= 15.2  + 0 AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 5.1 + 0  AND phh2o + 0 <= 7.8 + 0  AND ecc + 0 <= 2 + 0  AND soimoistdept_r + 0  >= 45 + 0  AND soimoistdept_r + 0 < 120 + 0  AND histosols == "no"
			THEN "11" 
			#DISPLAY "The soil falls into a gap in the criteria.  The nearest match is group 10 with soil depth %s being too shallow for group 1ss." soil_depth.

			ELSE IF ISNULL (ctsg) AND soil_depth + 0 >= 100 + 0  AND total_awc + 0 >= 7.6 + 0  AND total_awc + 0 <= 15.2  + 0 AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 7.9 + 0 AND phh2o + 0 <= 8.4 + 0 AND ecc + 0 <= 2 + 0  AND soimoistdept_r + 0  >= 45 + 0  AND soimoistdept_r + 0 < 120 + 0  AND histosols == "no"
			THEN "1sk" 
			#DISPLAY "The soil falls into a gap in the criteria. The nearest match is group 1sk with CaCO3 %s being outside the range." CaCO3_equiv.

			ELSE IF ISNULL (ctsg) AND soil_depth + 0 >= 100 + 0  AND total_awc + 0 >= 7.6 + 0  AND total_awc + 0 <= 15.2  + 0 AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 5.1 + 0  AND phh2o + 0 <= 7.8 + 0  AND ecc + 0  > 2 + 0 AND ecc + 0 <= 4 + 0  AND soimoistdept_r + 0  >= 45 + 0  AND soimoistdept_r + 0 < 120 + 0  AND histosols == "no"
			THEN "1ss" 
			#DISPLAY "An onsite investigation is needed, the soil falls into a gap in the criteria. The nearest match is group 1ss with EC %s being outside the range." ecc.

			ELSE IF ISNULL (ctsg) AND soil_depth + 0 >= 50 + 0  AND soil_depth + 0 < 100 + 0 AND total_awc + 0 >= 7.6 + 0  AND total_awc + 0 <= 15.2  + 0 AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 4.0 + 0 AND phh2o + 0 <= 5.0 + 0  AND ecc + 0 <= 2 + 0  AND soimoistdept_r + 0  >= 45 + 0  AND soimoistdept_r + 0 < 120 + 0  AND histosols == "no"
			THEN "11"
			#DISPLAY "The soil falls into a gap in the criteria. The nearest match is group 10 with soil depth %s being too shallow for group 1ssa." soil_depth.

			ELSE IF ISNULL (ctsg) AND soil_depth + 0 >= 100 + 0  AND total_awc + 0 >= 7.6 + 0  AND total_awc + 0 <= 15.2  + 0 AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 4.0 + 0 AND phh2o + 0 <= 5.0 + 0  AND ecc + 0  > 2 + 0 AND ecc + 0 <= 4 + 0  AND soimoistdept_r + 0  >= 45 + 0  AND soimoistdept_r + 0 < 120 + 0  AND histosols == "no"
			THEN "1ssa" 
			#DISPLAY "The soil falls into a gap in the criteria. The nearest match is group 1ssa with EC %s being outside the range." ecc.

# Group 2 -------------------
			ELSE IF ISNULL (ctsg) AND soil_depth + 0 >= 50 + 0  AND soil_depth + 0 < 100 + 0 AND total_awc + 0 >= 7.6 + 0  AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 5.1 + 0  AND phh2o + 0 <= 7.8 + 0  AND ecc + 0 <= 2 + 0  AND soimoistdept_r + 0  >= 15 AND soimoistdept_r + 0 < 45 + 0 AND histosols == "no"
			THEN "11" 
			#DISPLAY "The soil falls into a gap in the criteria. The nearest match is group 10 with soil depth %s being too shallow for group 2." soil_depth.

			ELSE IF ISNULL (ctsg) AND soil_depth + 0 >= 100 + 0  AND total_awc + 0 >= 7.6 + 0  AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 7.9 + 0 AND phh2o + 0 <= 8.4 + 0 AND ecc + 0 <= 2 + 0  AND soimoistdept_r + 0  >= 15 AND soimoistdept_r + 0 < 45 + 0 AND histosols == "no"
			THEN "2k" 
			#DISPLAY "The soil falls into a gap in the criteria. The nearest match is group 2k with CaCO3 %s being outside the range." CaCO3_equiv.
	
			ELSE IF ISNULL (ctsg) AND soil_depth + 0 >= 100 + 0  AND total_awc + 0 >= 7.6 + 0  AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 5.1 + 0  AND phh2o + 0 <= 7.8 + 0  AND ecc + 0  > 2 + 0 AND ecc + 0 <= 4 + 0  AND soimoistdept_r + 0  >= 15 AND soimoistdept_r + 0 < 45 + 0 AND histosols == "no" 
			THEN "2"
			#DISPLAY "The soil falls into a gap in the criteria. The nearest match is group 2 with EC %s being outside the range." ecc.

			ELSE IF ISNULL (ctsg) AND soil_depth + 0 >= 50 + 0  AND soil_depth + 0 < 100 + 0 AND total_awc + 0 >= 7.6 + 0  AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 4.0 + 0 AND phh2o + 0 <= 5.0 + 0  AND ecc + 0 <= 2 + 0  AND soimoistdept_r + 0  >= 15 AND soimoistdept_r + 0 < 45 + 0 AND histosols == "no"
			THEN "11" 
			#DISPLAY "The soil falls into a gap in the criteria. The nearest match is group 10 with soil depth %s being too shallow for group 2a." soil_depth.
	
			ELSE IF ISNULL (ctsg) AND soil_depth + 0 >= 100 + 0  AND total_awc + 0 >= 7.6 + 0  AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 4.0 + 0 AND phh2o + 0 <= 5.0 + 0  AND ecc + 0  > 2 + 0 AND ecc + 0 <= 4 + 0  AND soimoistdept_r + 0  >= 15 AND soimoistdept_r + 0 < 45 + 0 AND histosols == "no"
			THEN "2a" 
			#DISPLAY "The soil falls into a gap in the criteria. The nearest match is group 2a with EC %s being outside the range." ecc.

			ELSE IF ISNULL (ctsg) AND soil_depth + 0 >= 50 + 0  AND soil_depth + 0 < 100 + 0 AND total_awc + 0 >= 7.6 + 0  AND CaCO3_equiv + 0  > 5 + 0 AND CaCO3_equiv + 0 <= 15 + 0 AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 7.9 + 0 AND phh2o + 0 <= 8.4 + 0 AND ecc + 0 <= 4 + 0  AND soimoistdept_r + 0  >= 15 AND soimoistdept_r + 0 < 45 + 0 AND histosols == "no" 
			THEN "11"
			#DISPLAY "The soil falls into a gap in the criteria. The nearest match is group 10 with soil depth %s being too shallow for group 2k." soil_depth.
	
			ELSE IF ISNULL (ctsg) AND soil_depth + 0 >= 100 + 0  AND total_awc + 0 >= 22.5 + 0 
			and phh2o + 0 >= 7.9 + 0 AND phh2o + 0 <= 8.4 + 0 AND ecc + 0 <= 4 + 0  AND soimoistdept_r + 0  >= 15 AND soimoistdept_r + 0 < 45 + 0 AND histosols == "yes"
			THEN "2h"
			#DISPLAY "The soil falls into a gap in the criteria. The nearest match is group 2h with pH %s being outside the range." phh2o.
			
# Group 3 -------------------
			ELSE IF ISNULL (ctsg) AND soil_depth + 0 >= 100 + 0  AND total_awc + 0 >= 22.5 + 0  AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 7.9 + 0 AND phh2o + 0 <= 8.4 + 0 AND ecc + 0 <= 2 + 0  AND (soimoistdept_r + 0  >= 120 + 0  OR ISNULL (soimoistdept_r)) AND loamy == "yes" AND histosols == "no"
			THEN "8"
			#DISPLAY "The soil falls into a gap in the criteria. The nearest match is group 8 with CaCO3 %s being outside the range." CaCO3_equiv.

			ELSE IF ISNULL (ctsg) AND soil_depth + 0 >= 100 + 0  AND total_awc + 0 >= 22.5 + 0  AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 5.1 + 0  AND phh2o + 0 <= 7.8 + 0  AND ecc + 0  > 2 + 0 AND ecc + 0 <= 4 + 0  AND (soimoistdept_r + 0  >= 120 + 0  OR ISNULL (soimoistdept_r))and loamy == "yes" AND histosols == "no"
			THEN "3"
			#DISPLAY "The soil falls into a gap in the criteria. The nearest match is group 3 with EC %s being outside the range." ecc.

			ELSE IF ISNULL (ctsg) AND soil_depth + 0 >= 100 + 0  AND total_awc + 0 >= 22.5 + 0  AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 4.0 + 0 AND phh2o + 0 <= 5.0 + 0  AND ecc + 0  > 2 + 0 AND ecc + 0 <= 4 + 0  AND (soimoistdept_r + 0  >= 120 + 0  OR ISNULL (soimoistdept_r)) AND loamy == "yes" AND histosols == "no"
			THEN "3a" 
			#DISPLAY "The soil falls into a gap in the criteria. The nearest match is group 3a with EC %s being outside the range." ecc.
	
# Group 4 -------------------	
			ELSE IF ISNULL (ctsg) AND soil_depth + 0 >= 50 + 0  AND total_awc + 0 >= 17.0 + 0 AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 7.9 + 0 AND phh2o + 0 <= 8.4 + 0 AND ecc + 0 <= 2 + 0  AND (soimoistdept_r + 0  >= 120 + 0  OR ISNULL (soimoistdept_r))
			and depth_to_clayey > 20 AND depth_to_clayey <= 50 + 0 AND not isnull(depth_to_clayey) AND histosols == "no"
			THEN "4k" 
			#DISPLAY "The soil falls into a gap in the criteria. The nearest match is group 4k with CaCO3 %s being outside the range." CaCO3_equiv.

			ELSE IF ISNULL (ctsg) AND soil_depth + 0 >= 50 + 0  AND total_awc + 0 >= 17.0 + 0 AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 5.1 + 0  AND phh2o + 0 <= 7.8 + 0  AND ecc + 0  > 2 + 0 AND ecc + 0 <= 4 + 0  AND (soimoistdept_r + 0  >= 120 + 0  OR ISNULL (soimoistdept_r))
			and depth_to_clayey > 20 AND depth_to_clayey <= 50 + 0 AND not isnull(depth_to_clayey) AND histosols == "no"
			THEN "4"
			#DISPLAY "The soil falls into a gap in the criteria. The nearest match is group 4 with EC %s being outside the range." ecc.

			ELSE IF ISNULL (ctsg) AND soil_depth + 0 >= 50 + 0  AND total_awc + 0 >= 17.0 + 0 AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 4.0 + 0 AND phh2o + 0 <= 5.0 + 0  AND ecc + 0  > 2 + 0 AND ecc + 0 <= 4 + 0  AND (soimoistdept_r + 0  >= 120 + 0  OR ISNULL (soimoistdept_r))
			and depth_to_clayey > 20 AND depth_to_clayey <= 50 + 0 AND not isnull(depth_to_clayey) AND histosols == "no"
			THEN "4a" 
			#DISPLAY "The soil falls into a gap in the criteria. The nearest match is group 4a with EC %s being outside the range." ecc.

			ELSE IF ISNULL (ctsg) AND soil_depth + 0 >= 50 + 0  AND total_awc + 0 >= 10.0 AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 4.0 + 0 AND phh2o + 0 <= 5.0 + 0  AND ecc + 0  > 2 + 0 AND ecc + 0 <= 4 + 0  AND (soimoistdept_r + 0  >= 120 + 0  OR ISNULL (soimoistdept_r))
			and depth_to_clayey > 20 AND depth_to_clayey <= 50 + 0 AND not isnull(depth_to_clayey) AND histosols == "no"
			THEN "4sa"
			#DISPLAY "The soil falls into a gap in the criteria. The nearest match is group 4sa with EC %s being outside the range." ecc.

			ELSE IF ISNULL (ctsg) AND soil_depth + 0 >= 50 + 0  AND total_awc + 0 >= 15.2 + 0 AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 7.9 + 0 AND phh2o + 0 <= 8.4 + 0 AND ecc + 0 <= 2 + 0  AND (soimoistdept_r + 0  >= 120 + 0  OR ISNULL (soimoistdept_r)) AND clayey == "yes" AND histosols == "no"
			THEN "4ck"
			#DISPLAY "The soil falls into a gap in the criteria. The nearest match is group 4ck with CaCO3 %s being outside the range." CaCO3_equiv

			ELSE IF ISNULL (ctsg) AND soil_depth + 0 >= 50 + 0  AND total_awc + 0 >= 15.2 + 0 AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 5.1 + 0  AND phh2o + 0 <= 7.8 + 0  AND ecc + 0  > 2 + 0 AND ecc + 0 <= 4 + 0  AND (soimoistdept_r + 0  >= 120 + 0  OR ISNULL (soimoistdept_r)) AND clayey == "yes" AND histosols == "no"
			THEN "4c" 
			#DISPLAY "The soil falls into a gap in the criteria. The nearest match is group 4c with EC %s being outside the range." ecc.

			ELSE IF ISNULL (ctsg) AND soil_depth + 0 >= 50 + 0  AND total_awc + 0 >= 15.2 + 0 AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 4.0 + 0 AND phh2o + 0 <= 5.0 + 0  AND ecc + 0  > 2 + 0 AND ecc + 0 <= 4 + 0  AND (soimoistdept_r + 0  >= 120 + 0  OR ISNULL (soimoistdept_r)) AND clayey == "yes" AND histosols == "no"
			THEN "4ca" 
			#DISPLAY "The soil falls into a gap in the criteria. The nearest match is group 4ca with EC %s being outside the range." ecc.

			ELSE IF ISNULL (ctsg) AND soil_depth + 0 >= 50 + 0  AND total_awc + 0 >= 15.2 + 0 AND CaCO3_equiv + 0  > 5 + 0 AND CaCO3_equiv + 0 <= 15 + 0 AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 7.5 AND phh2o + 0 <= 8.4 + 0 AND ecc + 0 <= 4 + 0  AND (soimoistdept_r + 0  >= 120 + 0  OR ISNULL (soimoistdept_r))
			and clayey == "yes" AND histosols == "no" THEN "4ck"
			#DISPLAY "The soil falls into a gap in the criteria. The nearest match is group 4ck with pH %s being outside the range." phh2o.
# Group 5 -------------------
			ELSE IF ISNULL (ctsg) AND soil_depth + 0 >= 100 + 0  AND total_awc + 0 >= 15.2 + 0 AND total_awc + 0 <= 22.4 + 0  AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 7.9 + 0 AND phh2o + 0 <= 8.4 + 0 AND ecc + 0 <= 2 + 0  AND (soimoistdept_r + 0  >= 120 + 0  OR ISNULL (soimoistdept_r)) AND sandy == "no" AND histosols == "no"
			THEN "5k" 
			#DISPLAY "The soil falls into a gap in the criteria. The nearest match is group 5k with CaCO3 %s being outside the range." CaCO3_equiv.

			ELSE IF ISNULL (ctsg) AND soil_depth + 0 >= 100 + 0  AND total_awc + 0 >= 15.2 + 0 AND total_awc + 0 <= 22.4 + 0  AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 5.1 + 0  AND phh2o + 0 <= 7.8 + 0  AND ecc + 0  > 2 + 0 AND ecc + 0 <= 4 + 0  AND (soimoistdept_r + 0  >= 120 + 0  OR ISNULL (soimoistdept_r)) AND sandy == "no" AND histosols == "no"
			THEN "5"
			#DISPLAY "The soil falls into a gap in the criteria. The nearest match is group 5 with EC %s being outside the range." ecc.

			ELSE IF ISNULL (ctsg) AND soil_depth + 0 >= 100 + 0  AND total_awc + 0 >= 15.2 + 0 AND total_awc + 0 <= 22.4 + 0  AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 4.0 + 0 AND phh2o + 0 <= 5.0 + 0  AND ecc + 0  > 2 + 0 AND ecc + 0 <= 4 + 0  AND (soimoistdept_r + 0  >= 120 + 0  OR ISNULL (soimoistdept_r)) AND sandy == "no" AND histosols == "no"
			THEN "5a"
			#DISPLAY "The soil falls into a gap in the criteria. The nearest match is group 5a with EC %s being outside the range." ecc.

# Group 6 -------------------
			ELSE IF ISNULL (ctsg) AND soil_depth + 0 >= 50 + 0  AND total_awc + 0 >= 7.6 + 0  AND total_awc + 0 <= 15.1  + 0 AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 7.9 + 0 AND phh2o + 0 <= 8.4 + 0 AND ecc + 0 <= 2 + 0  AND (soimoistdept_r + 0  >= 120 + 0  OR ISNULL (soimoistdept_r))
			and (depth_to_sandy + 0 > 20 + 0 OR ISNULL (depth_to_sandy)) AND histosols == "no" 
			THEN "6k"
			#DISPLAY "The soil falls into a gap in the criteria. The nearest match is group 6k with CaCO3 %s being outside the range." CaCO3_equiv.

			ELSE IF ISNULL (ctsg) AND soil_depth + 0 >= 50 + 0  AND total_awc + 0 >= 7.6 + 0  AND total_awc + 0 <= 15.1  + 0 AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 5.1 + 0  AND phh2o + 0 <= 7.8 + 0  AND ecc + 0  > 2 + 0 AND ecc + 0 <= 4 + 0  AND (soimoistdept_r + 0  >= 120 + 0  OR ISNULL (soimoistdept_r))
			and (depth_to_sandy + 0 > 20 + 0 OR ISNULL (depth_to_sandy)) AND histosols == "no"
			THEN "6" 
			#DISPLAY "The soil falls into a gap in the criteria. The nearest match is group 6 with EC %s being outside the range." ecc.

			ELSE IF ISNULL (ctsg) AND soil_depth + 0 >= 50 + 0  AND total_awc + 0 >= 7.6 + 0  AND total_awc + 0 <= 15.1  + 0 AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 4.0 + 0 AND phh2o + 0 <= 5.0 + 0  AND ecc + 0  > 2 + 0 AND ecc + 0 <= 4 + 0  AND (soimoistdept_r + 0  >= 120 + 0  OR ISNULL (soimoistdept_r))
			and (depth_to_sandy + 0 > 20 + 0 OR ISNULL (depth_to_sandy)) AND histosols == "no"
			THEN "6a" 
			#DISPLAY "The soil falls into a gap in the criteria. The nearest match is group 6a with EC %s being outside the range." ecc.

			ELSE IF ISNULL (ctsg) AND soil_depth + 0 >= 50 + 0  AND soil_depth + 0 <=100 + 0 AND total_awc + 0 >= 15.2 + 0 AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 7.9 + 0 AND phh2o + 0 <= 8.4 + 0 AND ecc + 0 <= 2 + 0  AND (soimoistdept_r + 0  >= 120 + 0  OR ISNULL (soimoistdept_r))
			and (depth_to_sandy + 0 > 20 + 0 OR ISNULL (depth_to_sandy)) AND histosols == "no"
			THEN "6dk" 
			#DISPLAY "The soil falls into a gap in the criteria. The nearest match is group 6dk with CaCO3 %s being outside the range." CaCO3_equiv.

			ELSE IF ISNULL (ctsg) AND soil_depth + 0 >= 50 + 0  AND soil_depth + 0 <=100 + 0 AND total_awc + 0 >= 15.2 + 0 AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 5.1 + 0  AND phh2o + 0 <= 7.8 + 0  AND ecc + 0  > 2 + 0 AND ecc + 0 <= 4 + 0  AND (soimoistdept_r + 0  >= 120 + 0  OR ISNULL (soimoistdept_r))
			and (depth_to_sandy + 0 > 20 + 0 OR ISNULL (depth_to_sandy)) AND histosols == "no"
			THEN "6d" 
			#DISPLAY "The soil falls into a gap in the criteria. The nearest match is group 6d with EC %s being outside the range." ecc.

			ELSE IF ISNULL (ctsg) AND soil_depth + 0 >= 50 + 0  AND soil_depth + 0 <=100 + 0 AND total_awc + 0 >= 15.2 + 0 AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 4.0 + 0 AND phh2o + 0 <= 5.0 + 0  AND ecc + 0  > 2 + 0 AND ecc + 0 <= 4 + 0  AND (soimoistdept_r + 0  >= 120 + 0  OR ISNULL (soimoistdept_r))
			and (depth_to_sandy + 0 > 20 + 0 OR ISNULL (depth_to_sandy)) AND histosols == "no"
			THEN "6da"
			#DISPLAY "The soil falls into a gap in the criteria. The nearest match is group 6da with EC %s being outside the range." ecc.

# Group 7 -------------------
			ELSE IF ISNULL (ctsg) AND soil_depth + 0 >= 50 + 0  AND total_awc + 0 >= 7.6 + 0  AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 7.9 + 0 AND phh2o + 0 <= 8.4 + 0 AND ecc + 0 <= 2 + 0  AND (soimoistdept_r + 0  >= 120 + 0  OR ISNULL (soimoistdept_r))
			and (depth_to_sandy == 0 OR O_hrzn_depth == depth_to_sandy) AND not isnull(depth_to_sandy)
			and (sandy == "yes" OR sandy_gravelly == "yes") AND histosols == "no"
			THEN "7sk" 
			#DISPLAY "The soil falls into a gap in the criteria. The nearest match is group 7sk with CaCO3 %s being outside the range." CaCO3_equiv.

			ELSE IF ISNULL (ctsg) AND soil_depth + 0 >= 50 + 0  AND total_awc + 0 >= 7.6 + 0  AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 5.1 + 0  AND phh2o + 0 <= 7.8 + 0  AND ecc + 0  > 2 + 0 AND ecc + 0 <= 4 + 0  AND (soimoistdept_r + 0  >= 120 + 0  OR ISNULL (soimoistdept_r))
			and (depth_to_sandy == 0 OR O_hrzn_depth == depth_to_sandy) AND not isnull(depth_to_sandy)
			and (sandy == "yes" OR sandy_gravelly == "yes") AND histosols == "no"
			THEN "7s" 
			#DISPLAY "The soil falls into a gap in the criteria. The nearest match is group 7s with EC %s being outside the range." ecc.

			ELSE IF ISNULL (ctsg) AND soil_depth + 0 >= 50 + 0  AND total_awc + 0 >= 7.6 + 0  AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 4.0 + 0 AND phh2o + 0 <= 5.0 + 0  AND ecc + 0  > 2 + 0 AND ecc + 0 <= 4 + 0  AND (soimoistdept_r + 0  >= 120 + 0  OR ISNULL (soimoistdept_r))
			and (depth_to_sandy == 0 OR O_hrzn_depth == depth_to_sandy) AND not isnull(depth_to_sandy)
			and (sandy == "yes" OR sandy_gravelly == "yes") AND histosols == "no"
			THEN "7sa"
			#DISPLAY "The soil falls into a gap in the criteria. The nearest match is group 7sa with EC %s being outside the range." ecc.

			ELSE IF ISNULL (ctsg) AND soil_depth + 0 >= 50 + 0  AND total_awc + 0 >= 7.6 + 0  AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 7.9 + 0 AND phh2o + 0 <= 8.4 + 0 AND ecc + 0 <= 2 + 0  AND (soimoistdept_r + 0  >= 120 + 0  OR ISNULL (soimoistdept_r))
			and (depth_to_sandy == 0 OR O_hrzn_depth == depth_to_sandy) AND not isnull(depth_to_sandy) AND histosols == "no"
			THEN "7k" 
			#DISPLAY "The soil falls into a gap in the criteria. The nearest match is group 7k with CaCO3 %s being outside the range." CaCO3_equiv.

			ELSE IF ISNULL (ctsg) AND soil_depth + 0 >= 50 + 0  AND total_awc + 0 >= 7.6 + 0  AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 5.1 + 0  AND phh2o + 0 <= 7.8 + 0  AND ecc + 0  > 2 + 0 AND ecc + 0 <= 4 + 0  AND (soimoistdept_r + 0  >= 120 + 0  OR ISNULL (soimoistdept_r))
			and (depth_to_sandy == 0 OR O_hrzn_depth == depth_to_sandy) AND not isnull(depth_to_sandy) AND histosols == "no"
			THEN "7" 
			#DISPLAY "The soil falls into a gap in the criteria. The nearest match is group 7 with EC %s being outside the range." ecc.

			ELSE IF ISNULL (ctsg) AND soil_depth + 0 >= 50 + 0  AND total_awc + 0 >= 7.6 + 0  AND CaCO3_equiv + 0 <= 5 + 0  AND sodium + 0 < 13 + 0 
			and phh2o + 0 >= 4.0 + 0 AND phh2o + 0 <= 5.0 + 0  AND ecc + 0  > 2 + 0 AND ecc + 0 <= 4 + 0  AND (soimoistdept_r + 0  >= 120 + 0  OR ISNULL (soimoistdept_r))
			and (depth_to_sandy == 0 OR O_hrzn_depth == depth_to_sandy) AND not isnull(depth_to_sandy) AND histosols == "no"
			THEN "7a"
			#DISPLAY "The soil falls into a gap in the criteria. The nearest match is group 7a with EC %s being outside the range." ecc.

			ELSE ctsg.

ASSIGN ctsg		IF any (floddurcl2 == "Long (7 to 30 days)") AND (ctsg == "2" OR ctsg == "2a" OR ctsg == "2k" OR ctsg == "2h") 
					and not isnull(ctsg) THEN ctsg || "f"
				ELSE IF any (floddurcl2 == "Long (7 to 30 days)" OR floddurcl2 == "Very long (more than 30 days)") THEN "10" 
				ELSE IF any (floddurcl2 == "Brief (2 to 7 days)" OR floddurcl2 == "Very brief (4 to 48 hours)") AND not isnull(ctsg) and
				ctsg != "10" THEN ctsg || "f" 
				ELSE ctsg.

ASSIGN ctsg		IF compkind2 == "miscellaneous area" THEN null ELSE ctsg.


DEFINE CTSG_Grouping IF ctsg == '1' THEN 'Wet' ELSE
IF ctsg == '1a' THEN 'Wet Favorable - Acid' ELSE
IF ctsg == '1h' THEN 'Wet Favorable - Organic' ELSE
IF ctsg == '1k' THEN 'Wet Favorable - Carbonates' ELSE
IF ctsg == '1s' THEN 'Wet Favorable - Droughty' ELSE
IF ctsg == '1sa' THEN 'Wet Favorable - Acid - Droughty' ELSE
IF ctsg == '1sk' THEN 'Wet Favorable - Carbonates - Droughty' ELSE
IF ctsg == '1ss' THEN 'Wet Favorable - Very Droughty' ELSE
IF ctsg == '1ssa' THEN 'Wet Favorable - Acid - Very Droughty' ELSE
IF ctsg == '2' THEN 'Wet' ELSE
IF ctsg == '2a' THEN 'Wet - Acid' ELSE
IF ctsg == '2k' THEN 'Wet - Carbonates' ELSE
IF ctsg == '2h' THEN 'Wet - Organic' ELSE
IF ctsg == '3' THEN 'Loamy' ELSE
IF ctsg == '3a' THEN 'Loamy - Acid' ELSE
IF ctsg == '4' THEN 'Clayey Favorable' ELSE
IF ctsg == '4a' THEN 'Clayey Favorable - Acid' ELSE
IF ctsg == '4sa' THEN 'Clayey Favorable - Acid' ELSE
IF ctsg == '4k' THEN 'Clayey Favorable - Carbonates' ELSE
IF ctsg == '4c' THEN 'Clayey' ELSE
IF ctsg == '4ca' THEN 'Clayey - Acid' ELSE
IF ctsg == '4ck' THEN 'Clayey - Carbonates' ELSE
IF ctsg == '5' THEN 'Droughty' ELSE
IF ctsg == '5a' THEN 'Droughty - Acid' ELSE
IF ctsg == '5k' THEN 'Droughty - Carbonates' ELSE
IF ctsg == '6' THEN 'Very droughty' ELSE
IF ctsg == '6a' THEN 'Very Droughty - Acid' ELSE
IF ctsg == '6k' THEN 'Very Droughty - Carbonates' ELSE
IF ctsg == '6d' THEN 'Droughty - Moderately deep' ELSE
IF ctsg == '6da' THEN 'Droughty - Moderately deep - Acid' ELSE
IF ctsg == '6dk' THEN 'Droughty - Moderately deep - Carbonates' ELSE
IF ctsg == '7' THEN 'Sandy' ELSE
IF ctsg == '7k' THEN 'Sandy - Carbonates' ELSE
IF ctsg == '7a' THEN 'Sandy - Acid' ELSE
IF ctsg == '7s' THEN 'Sandy Throughout' ELSE
IF ctsg == '7sk' THEN 'Sandy Throughout - Carbonates' ELSE
IF ctsg == '7sa' THEN 'Sandy Throughout - Acid' ELSE
IF ctsg == '8' THEN 'Loamy - Carbonates' ELSE
IF ctsg == '9' THEN 'Dry - Saline/Alkaline' ELSE
IF ctsg == '9w' THEN 'Wet - Saline/Alkaline' ELSE
IF ctsg == '10' THEN 'On-site evaluation' ELSE
IF ctsg == '11' THEN 'Does not fit any grouping'
 ELSE 'Null' .

TEMPLATE heads TAG "td"
    ELEMENT "tr" FIELD, FIELD, FIELD, FIELD, FIELD, FIELD, FIELD,
 FIELD, FIELD, FIELD, FIELD, FIELD	, FIELD, FIELD, FIELD, FIELD,FIELD	,FIELD.

TEMPLATE mapunit TAG "td"
    ELEMENT "tr" ATTRIB ("class", "mapunit") 
	FIELD TAG "td" ATTRIB ("colspan", "7") VALUETAG "para" ATTRIB ("role", "mu-name") ,#. #,
	#FIELD, FIELD, FIELD, FIELD, FIELD , FIELD,
	FIELD, FIELD, FIELD, FIELD , FIELD, FIELD, FIELD, FIELD , FIELD, FIELD,FIELD
	.
 
TEMPLATE basic REPLACE NULL WITH "---"
    ELEMENT "tr" ATTRIB ("class", shading) 
	FIELD TAG "td" VALUETAG "para", 
	FIELD TAG "td" VALUETAG "para", FIELD TAG "td" VALUETAG "para", 
	FIELD TAG "td" VALUETAG "para" ATTRIB ("role", "number"), 
	FIELD TAG "td" VALUETAG "para" ATTRIB ("role", "hang-list"), 
	FIELD TAG "td" VALUETAG "para" ATTRIB ("role", "hang-list"), FIELD TAG "td" VALUETAG "para" ATTRIB ("role", "hang-list"),
	
	FIELD TAG "td" VALUETAG "para" ATTRIB ("role", "hang-list"),
	FIELD TAG "td" VALUETAG "para" ATTRIB ("role", "hang-list"),
	FIELD TAG "td" VALUETAG "para" ATTRIB ("role", "hang-list"),
	FIELD TAG "td" VALUETAG "para" ATTRIB ("role", "hang-list"),
		FIELD TAG "td" VALUETAG "para" ATTRIB ("role", "hang-list"),
		
			FIELD TAG "td" VALUETAG "para" ATTRIB ("role", "hang-list"),
	FIELD TAG "td" VALUETAG "para" ATTRIB ("role", "hang-list"),
	FIELD TAG "td" VALUETAG "para" ATTRIB ("role", "hang-list"),
		FIELD TAG "td" VALUETAG "para" ATTRIB ("role", "hang-list"),	FIELD TAG "td" VALUETAG "para" ATTRIB ("role", "hang-list"),
	FIELD TAG "td" VALUETAG "para" ATTRIB ("role", "hang-list")
	
	.


HEADER INITIAL
    ELEMENT OPEN "section" ATTRIB ("label", "SoilReport").
    ELEMENT "title" reporttitle.
    IF reporthdrtext!="" ELEMENT "para" ATTRIB ("role", "headnote") reporthdrtext.
END HEADER.

SECTION WHEN FIRST OF areabreak
DATA
    ELEMENT OPEN "table".
      IF useNationalMapunits==0 ELEMENT "title" areaname.
	  IF useNationalMapunits!=0 INCLUDE "Subreport for area names" (areasym, mukeys).
      ELEMENT "col" ATTRIB("width", "0.5*").
      ELEMENT "col" ATTRIB("width", "1*").
      ELEMENT "col" ATTRIB("width", "0.5*").
      ELEMENT "col" ATTRIB("width", "0.5*").
   ELEMENT "col" ATTRIB("width", "1*").
		ELEMENT "col" ATTRIB("width", "1*").
			ELEMENT "col" ATTRIB("width", "1*").
			ELEMENT "col" ATTRIB("width", "1*").
			   ELEMENT "col" ATTRIB("width", "1*").
		ELEMENT "col" ATTRIB("width", "1*").
			ELEMENT "col" ATTRIB("width", "1*").
			ELEMENT "col" ATTRIB("width", "1*").
			ELEMENT "col" ATTRIB("width", "1*").
    ELEMENT OPEN "thead".
    USING heads
	"Map symbol AND map unit name",
	"Component AND local phase",
	"MLRA",
	"Percent of map unit",
	"Landform",
	"Calc. CTSG", "Grouping", 
	"CaCO3_equiv",		
"soil_depth	",	
"total_awc",
"phh2o",
"soimoistdept_r", "ecc", "sandy", "sandy_gravelly", "loamy", "clayey", "histosols".
    ELEMENT CLOSE "thead".  
  
    ELEMENT OPEN "tbody".    
END SECTION.

SECTION WHEN FIRST OF mapunit.mukey
DATA
    USING mapunit mu_lead .#, space, space, space, space, space, space, space.
END SECTION.

SECTION
DATA
    USING basic
	space, 
	soilnm, mlra2, comppct_r,
	landform, ctsg, ctsg_grouping, CaCO3_equiv DECIMAL 2,		
soil_depth,		
total_awc DECIMAL 2,
phh2o DECIMAL 1,
soimoistdept_r, ecc DECIMAL 2, sandy , sandy_gravelly , loamy , clayey, histosols.
END SECTION.

SECTION WHEN LAST OF areabreak
DATA
    ELEMENT CLOSE "tbody".
    ELEMENT CLOSE "table".
END SECTION.

SECTION WHEN AT END
DATA
    ELEMENT CLOSE "section".
END SECTION.