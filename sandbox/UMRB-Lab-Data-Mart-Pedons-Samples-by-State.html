<!DOCTYPE HTML>
<html>
<head>
 <meta http-equiv="X-UA-Compatible" content="IE=edge"> 
 <!--  <link rel="stylesheet" href="https://koala-bandits.github.io/nrcs-style/css/nrcs-style.min.css" media="all"> -->
 <link rel="stylesheet" href="https://jneme910.github.io/NRCS-Soil-Data-Access/style-sheet/nrcs-style.min.css" media="all"> 
  <link rel="stylesheet" href="https://koala-bandits.github.io/nrcs-style/css/nrcs-style-docs.min.css" media="all">
 <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.3.3/echarts.min.js"></script>
    <title>Upper Missouri River Basin (UMRB) Project</title>
<!-- Start Map -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
<!-- End Map -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <!--subtable -->
	
	
    <style type="text/css">
.tg  {border-collapse:collapse;border-spacing:0}
.tg td{font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:black;text-decoration:none !important}
.tg th{font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:black;}
.tg .tg-ul38{text-align:left;vertical-align:top;position:sticky;position:-webkit-sticky;top:-1px;will-change:transform}
.tg .tg-baqh{text-align:center;vertical-align:top}
.tg .tg-rz9m{text-align:center;vertical-align:top;position:sticky;position:-webkit-sticky;top:-1px;will-change:transform}
.tg .tg-0lax{text-align:left;vertical-align:top}
.tg-sort-header::-moz-selection{background:0 0}.tg-sort-header::selection{background:0 0}.tg-sort-header{cursor:pointer}.tg-sort-header:after{content:'';
float:right;margin-top:7px;border-width:0 5px 5px;border-style:solid;border-color:#404040 transparent;visibility:hidden}.tg-sort-header:hover:after{visibility:visible}.tg-sort-asc:after,.tg-sort-asc:hover:after,
.tg-sort-desc:after{visibility:visible;opacity:.4}.tg-sort-desc:after{border-bottom:none;border-width:5px 5px 0}@media screen and (max-width: 767px) {.tg {width: auto !important;}.tg col {width: auto !important;}
.tg-wrap {overflow-x: auto;-webkit-overflow-scrolling: touch;margin: auto 0px;}}</style>
<!--subtable .chart-container {
    width: 2500px;
    height:2600px
}-- >
    
    <!-- -->
   
<style type="text/css">
div {
    box-sizing: border-box;
    padding: 10px;
}
   ul.space_list li { margin-bottom: .2em; }
        .scrolltable {
            overflow-x: scroll;
            height: 100%;
            display: flex;
            display: -webkit-flex;
            flex-direction: column;
            -webkit-flex-direction: column;
        }
        .scrolltable > .header {
        }
        .scrolltable > .body {
            /*noinspection CssInvalidPropertyValue*/
            width: -webkit-fit-content;
            overflow-y: scroll;
            flex: 1;
            -webkit-flex: 1;
        }
        th, td {
            min-width: 25px;
            border-width: 1px;
            padding: 2px;
			text-decoration:none !important;
        }
        /* an outside constraint to react against */
        #constrainer {
            width: 400px;
            height: 200px;
        }
        #constrainer2 {
            width: 400px;
            overflow-x: scroll;
        }
        #constrainer2 table {
            overflow-y: scroll;
        }
        #constrainer2 tbody {
            overflow-x: scroll;
            display: block;
            height: 200px;
        }
        #constrainer2 thead {
            display: table-row;
        }
        /* only styling below here */
        #constrainer, #constrainer2 {
            border: 1px solid lightgrey;
        }
        table {
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid gray;
			text-decoration:none !important;
        }
        th {
            background-color: lightgrey;
            border-width: 1px;
        }
        td {
            border-width: 1px;
			text-decoration:none !important;
        }
        tr:first-child td {
            border-top-width: 0;
        }
        tr:nth-child(even) {
            background-color: #eee;
        }
    </style>
</head>
<body>
<section class="docs__section docs__intro">
      <h1 class="docs__bd docs__title">Upper Missouri River Basin (UMRB) Project<span class="docs__title__version" title="version"> </span></h1>
      <div class="docs__nav-shell" id="global-nav">
        <nav class="docs__nav">
          <ul class="docs__primary-nav" id="primary-navigation" aria-label="Primary Navigation" data-title="nrcs-style">
		  </section>
	<div>
<b>
 <!--        <font color='red'>
<h3>Web Soil Survey Metrics Report by a State</h3>

        </font> -->
    </b>
    <p>
   The Soil Data Access Web Services Query select list is used to pick a state or the Nation enabling creation of a "Upper Missouri River Basin (UMRB) Project Report" based upon those selections. The report list pedons by state with associated lab reports and pedon description . This report is for the federal, state, and university partners working on the Upper Missouri River Basin (UMRB) Project.  Soil and Plants Science Division (SPSD) is doing the soil sampling and lab analyses for that project.  
 	 
    <a href='#reportref'> For more information about the table, </a>
    </p> </p>
    <a name='top'>
    <!-- The following "div" tag will be updated with the retrieved data
        After the first selection the "(select a state)" will disappear -->
    <select id="selectId1" onchange="ChangeSelectedState(event)">
        <option value='' style="display: none" id="remove">(select a state)</option>
    </select>
    <div id="selectedStateId"><p>(no state selected)</p></div>

    <div id="id1"></div>
        <br></br>
		
		<div class='section'>
		<head>
		<meta charset='utf-8'>
		</meta>
	
        <div id="main" style="width: 1500px;height:600px;"></div>
		
		</br>
    <b>
        <font color='red'>
            <a name='reportref'>Report Metadata:</a>
        </font>
    </b>
    <php>
        <a href='#top'>Back to top</a>
    </php>
        <ul  class=space_list> <!-- class=space_list -->
<li ><b>Series: </b>The name assigned to the soil series.</li>
<li><b> User_pedon_ID:  </b>A short label to help a user identify a particular pedon.</li>
<li><b>Soil_Classification: </b>The date when the most recent change to the taxonomic classification of a particular soil series was made.</li>

<li><b>	hzn_desgn:	</b>	The concatenation of three kinds of symbols (four data elements) used in various combinations to designate layers within the soil. (SSM)	</li>
<li><b>	hzn_top:	</b>	The top (upper) depth of the layer.	</li>
<li><b>	hzn_bot:	</b>	The bottom (lower) depth of the layer.	</li>
<li><b>	sand_total:	</b>	Mineral particles 0.05mm to 2.0mm in equivalent diameter as a weight percentage of the less than 2 mm fraction.	</li>
<li><b>	silt_total:	</b>	Total silt is the soil separate with 0.002 to 0.05 mm particle size. It is reported as a gravimetric percent of the less than 2 mm fraction.	</li>
<li><b>	clay_total:	</b>	Total clay is the soil separate with less than 0.002 mm particle diameter. Clay size carbonate is included. Total clay is reported as a gravimetric percent of the less than2 mm fraction.	</li>
<li><b>	33 kPa wa:	</b>	The volumetric content of soil water retained at a tension of 1/3 bar (33 kPa), expressed as a percentage of the whole soil.	</li>
<li><b>	1500 kPa water:	</b>	The volumetric content of soil water retained at a tension of 15 bars (1500 kPa), expressed as a percentage of the whole soil.	</li>
<li><b>	BD 33 kPa:	</b>	The oven dry weight of the less than 2 mm soil material per unit volume of soil at a water tension of one third bar.	</li>
<li><b>	BD Oven Dry:	</b>	The oven dry weight of the less than 2 mm soil material per unit volume of soil exclusive of the desiccation cracks, measured on a coated clod.	</li>
 
   </ul>
		
	</div>
    <script>
        var tableData = []; 
        var url =  "https://sdmdataaccess.sc.egov.usda.gov/tabular/post.rest";
        var stateId = "";
        // Wait for everything to be loaded before starting the first SDA request
        $(document).ready(function(){
            // Start by retrieving a state list
            var data = {
                query: " WITH area_cte  (area_name, area_code) AS ( "
					+ "	SELECT area_name, "
					+ "	area_code "
					+ "		FROM lab_webmap "
					+ "		INNER JOIN lab_combine_nasis_ncss ON  lab_combine_nasis_ncss.pedon_key = lab_webmap.pedon_Key"
					+ "		INNER JOIN  (SELECT pedon_key FROM lab_layer "
					+ "		WHERE project_key IN (6357,6374,6375,6376,6395) ) AS s ON s.pedon_key = lab_combine_nasis_ncss.pedon_key"
					+ "		INNER JOIN lab_area ON lab_area.area_key=lab_combine_nasis_ncss.state_key"
					+ "		AND area_type= 'state_admin_div' AND area_sub_type ='state' AND parent_area_key = 244) "
					+ "		SELECT DISTINCT area_name, area_code"
					+ "	FROM area_cte ;",
				
				
				//"SELECT CASE WHEN [STATE]= 'xnational' THEN 'National' ELSE [STATE] END AS [state], CASE WHEN [STATE]= 'xnational' THEN 'National' ELSE [STATE] END AS stateid   FROM [wss_metric_query_results] GROUP BY [state] ORDER BY CASE WHEN  [state] = 'xnational' THEN 'aaaaaa' ELSE [state] END ASC  ;",
				
				
                //query: "Select statename, stateid from state  WHERE stateid IN ('AK', 'AL', 'AR', 'AZ', 'CA', 'CO', 'DC', 'DE', 'FL', 'GA', 'HI', 'IA', 'ID', 'IL', 'IN', 'KS', 'KY', 'LA', 'MA', 'MD', 'MI', 'MN', 'MS', 'MT', 'MX', 'NC', 'ND', 'NE', 'NJ', 'NM', 'NV', 'NY', 'OH', 'OK', 'OR', 'PA', 'PR', 'SC', 'SD', 'TN', 'TX', 'UT', 'VA', 'WA', 'WI', 'WV', 'WY')order by statename;",
                format: "json"
            }
            $.post(url, data, function( callbackData ) {
                console.log(callbackData, 'callbackData')
                    loadSelect("selectId1", callbackData.Table, 1, 0, "select a state");
                }, 
                "json");
        });
        function loadSelect(id, table, valueColumn, labelColumn, hintOption) {
            // Add options to the specified select list. The content of the table[valueColumn]
            // defines the value of the selection, the table[labelColumn] is used for the 
            // displayed option's text.
            var iRow = 0;
            $("#" + id)[0].innerHTML = "<option value='' style='display: none' id='remove'>(" + hintOption + ")</option>";
            while (iRow < table.length) {
                var row = table[iRow];
                var optionHtml = "<option value='" + row[valueColumn] + "'>" + row[labelColumn] + "</option>";
                $("#" + id).append(optionHtml);
                iRow++;
            }
        }
        function ChangeSelectedState(event) {
            // Update the selected state text area and then fetch and display report 1 results
            var stateId = event.target.value;
            var notification = $("#selectedStateId");
            notification[0].innerHTML = "<p>selected stateId = " + stateId + "</p>";
            var query =     " SELECT DISTINCT [Series] "
					+ "	,[User_pedon_ID] "

					+ "	,[Soil_Classification] "
					+ ", hzn_desgn, CAST (hzn_top AS real) AS hzn_top ,CAST (hzn_bot AS real) AS hzn_bot,  CAST ( sand_total AS REAL)  AS sand_total   , CAST (silt_total AS  real) AS silt_total, CAST (clay_total AS real) clay_total "
					+ " , CAST (water_retention_third_bar AS REAL) AS  [33 kPa water] , CAST (water_retention_15_bar AS REAL) AS [1500 kPa water]  , bulk_density_third_bar AS [BD 33 kPa] "
					+ " ,	bulk_density_oven_dry AS [BD Oven Dry] "
                    + "	 , REPLACE (CONCAT ('<a target=zz_blankzz href=zz' , [Primary_Lab_Report], 'zz>Click Here</a>'), 'zz', '''') AS [Primary Lab Report] "
					+ "	, REPLACE (CONCAT ('<a target=zz_blankzz href=zz' ,	 [Taxonomy_Report]	, 'zz>Click Here</a>'), 'zz', '''') AS [Taxonomy Report] "
					+ "	, REPLACE (CONCAT ('<a target=zz_blankzz href=zz' ,	      [Supplementary_Lab_Report]	, 'zz>Click Here</a>'), 'zz', '''') AS [Supplementary Lab Report] "
					+ "	, REPLACE (CONCAT ('<a target=zz_blankzz href=zz' ,	      [Water_Retention_Report]	, 'zz>Click Here</a>'), 'zz', '''') AS [Water Retention Report] "
					+ "	, REPLACE (CONCAT ('<a target=zz_blankzz href=zz' ,	      [Correlation_Report]	, 'zz>Click Here</a>'), 'zz', '''') AS [Correlation Report] " 
					+ "	, REPLACE (CONCAT ('<a target=zz_blankzz href=zz' ,	      [pedon_Description_Report]	, 'zz>Click Here</a>'), 'zz', '''') AS [pedon Description Report] "
					//+ "	, REPLACE (CONCAT ('<a target=zz_blankzz href=zz' ,	      [Soil_Profile]	, 'zz>Click Here</a>'), 'zz', '''') AS [Soil Profile] "
					+ "	, REPLACE (CONCAT ('<a target=zz_blankzz href=zz' ,	      [Soil_web]	, 'zz>Click Here</a>'), 'zz', '''') AS [ Soil_Web ] "
				
					+ "	FROM lab_webmap "
					+ "	INNER JOIN lab_combine_nasis_ncss ON  lab_combine_nasis_ncss.pedon_key = lab_webmap.pedon_Key "
					+ "	INNER JOIN lab_area ON lab_area.area_key=lab_combine_nasis_ncss.state_key AND area_code = '"  + stateId + "'"
					+ "	INNER JOIN  (SELECT pedon_key  , labsampnum, layer_key, hzn_desgn, hzn_top ,hzn_bot FROM lab_layer "
					+ "	WHERE project_key IN (6357,6374,6375,6376,6395) ) AS s ON s.pedon_key = lab_combine_nasis_ncss.pedon_key"
					+ "	INNER JOIN lab_physical_properties AS p ON p.labsampnum=s.labsampnum "
	+ " ORDER BY User_pedon_ID ASC, hzn_top ASC ,hzn_bot ASC "
			

;
            var data = {
                query: query,
                format: "json+columnname"
            }
            //+ " AND LEFT (ROUND ([sandmed_r]/[sandtotal_r],2),4) >= .40 ) "
            $.post(url, data, function( callbackData ) {
                console.log(callbackData, 'callbackData2')
                let i = 0
                // callbackData.forEach((item,i) => {
                //     tableData.push({
                //         name: item
                //     })
                // });
                let index2 = 0;
				tableData = [];
                for (let i = 0; i < callbackData.Table.length; i++) {
                        tableData.push({
                        name: callbackData.Table[0][i],
                        values: []
                    })
                    for (let i2 = 0; i2 < callbackData.Table.length; i2++) {
                        index2 = i2;
                        console.log(tableData, 88)
                        tableData[i].values.push(
                        callbackData.Table[i2][i]
                    )
                    }
                    tableData[i].values.shift()
                }
                console.log(tableData, 'tableData')
                createChart()
                // the success callback function: when executed add content to table
                    $('#id1')[0].innerHTML = "";
                    var tableHtml = '<table border="1">';
                    // for each row...
                                    var iRow = 0;
                while (iRow < callbackData.Table.length) {
                                var row = callbackData.Table[iRow];
                                tableHtml += "<tr>";
                                // for each column in each row...
                                var iCol = 0;
                                while (iCol < row.length) {
                                                if (iRow == 0) {
                                                                tableHtml += "<th>" + row[iCol] + "</th>";
                                                } else {
                                                                tableHtml += "<td>" + row[iCol] + "</td>";
                                                }
                                                iCol++;
                                };
                                tableHtml += "</tr>";                                  
                                iRow++;
                };
                    tableHtml += '</table>'
                    $('#id1').append(tableHtml);
                }, 
                // Specify that we want the request to be sent in JSON format
                "json");            
        }
        function createChart(){
        var myChart = echarts.init(document.getElementById('main'), 'dark'); 
		
		

        let legend = []
        tableData.forEach(element => {
            legend.push(element.name)
        });
        // let chartData = []
        // tableData.forEach(element => {
        //     legend.push(element.name)
        // });
        let xAxis = tableData[0].values; 
	
        let series = []
        tableData.forEach(element => {
            let data = [...element.values]
            data.forEach((item, i) =>{
                try {
                    data[i] = parseFloat(item.replace(/,/g, ''))
                } catch (error) {
                }
            })
            series.push(
            {
                name: element.name,
                type: 'bar',
                data: data
            }
            )
        });	
		series.shift();
        console.log(series, xAxis, legend, 'series, xAxis, chartData, legend')
        var option = {
		
        title: {
            text: ''
        },
        //tooltip: {}, //pounded out
		  toolbox: {
		  orient:'verticle',
		  
        show : true,
        feature : {
            mark : {show: true},
            dataView : {show: true, readOnly: false},
            magicType : {show: true, type: ['line', 'bar', 'stack', 'tiled']},
            restore : {show: true},
            saveAsImage : {show: true}

        }
		
    },
	
		
        // legend: {
        //     // data: [legend]
        //     data: ['Year']
        // },
     tooltip: {
    trigger: 'item'

  },
  legend: {data: legend},
	//	legend: {
	//	 orient: 'horizontal',
   //right: 500,
  //  top: 550,
  //  bottom: 20,
	//	data: legend},

	grid: {
  left: 80,
  top: 80,
  right: '10%',
  bottom: '20%'
},	


    type: 'image',
    style: {
        image: 'https://www.nrcs.usda.gov/NRCS_WIDTheme/themes/html/NRCS_WIDTheme/images/USDA-Logo.jpg',
        x: 100,
        y: 200,
        width: 230,
        height: 400
    }	,
        xAxis: {
            // data: ['Shirts', 'Cardigans', 'Chiffons', 'Pants', 'Heels', 'Socks'],
            data: xAxis,
            name: 'Year',
        },
        yAxis: {
            name: ''
        },
        series: series
        };
        // Display the chart using the configuration items and data just specified.
      // myChart.setOption(option);
	
		
		
        }
        // CHart Script
        $(document).ready(function(){
        // Initialize the echarts instance based on the prepared dom
        //var chartDom = document.getElementById('main');
		//var myChart = echarts.init(chartDom, 'dark');
        // Specify the configuration items and data for the chart
        var option = {
        title: {
            text: 'Web Soil Survey Metrics Report by a State or National'
        },
        tooltip: {},
		
        legend: {
            data: ['']
        },
        xAxis: {
            data: ['', '', '', '', '', ''],
            name: '',
        },
        yAxis: {
            name: ''
        },
        series: [
            {
            name: '',
            type: 'bar',
            data: [, , , , , ]
            }
        ]
        };
		
		
        // Display the chart using the configuration items and data just specified.
       //  myChart.setOption(option);
	
        });
    </script>
	


</body>	
</body>
</html>